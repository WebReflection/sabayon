let{parse:e,stringify:t,rawJSON:s,isRawJSON:r}=JSON;if(!s){const{freeze:n,setPrototypeOf:a}=Object;class o{static isRawJSON(e){return"object"==typeof e&&!!e&&#e in e}#e=!0;constructor(e){this.rawJSON=e,n(a(this,null))}}({isRawJSON:r}=o),s=t=>{const s=typeof t;switch(s){case"object":if(t)break;case"bigint":case"boolean":case"number":t=String(t);case"string":return e(t),new o(t)}throw new TypeError("Unexpected "+s)};const c=e;e=(e,t)=>{if("function"==typeof t){const s=t,r=[];e=String(e).replace(/(?:"(?:(?=(\\?))\1.)*?"\s*:?|[0-9eE.-]+|true|false|null)/g,(e=>":"!==e.at(-1)?'"'===e[0]?r.push(e)-1:`"${e}"`:e)),t=function(e,t){switch(typeof t){case"number":t=r[t];case"string":return s.call(this,e,c(t),{source:t})}return s.call(this,e,t)}}return c(e,t)};const{isArray:i}=Array,l=(e,t)=>t,p=(e,t)=>{let s=0;const n=`${Math.random()}00`.slice(2),a="function"==typeof e?e:e&&i(e)?(t,s)=>!t||e.includes(t)?s:void 0:l;return function(e,o){if(o=a.call(this,e,o),r(o)){const{rawJSON:e}=o;t.set(o=`'${++s}'${n}`,e)}return o}},u=t;t=(e,t,s)=>{const r=new Map,n=u(e,p(t,r),s);return r.size?n.replace(new RegExp(`"(${[...r.keys()].join("|")})"`,"g"),((e,t)=>r.get(t))):n}}const{ArrayBuffer:n,Atomics:a,Promise:o}=globalThis,{isArray:c}=Array,{create:i,getPrototypeOf:l,values:p}=Object,u=l(Int32Array),f=i(a),g=({currentTarget:e,type:t,origin:s,lastEventId:r,source:n,ports:a},o)=>e.dispatchEvent(new MessageEvent(t,{data:o,origin:s,lastEventId:r,source:n,ports:a})),w=()=>o.withResolvers();let y=0;const d=new Map,h=(e,t)=>class extends e{constructor(e,...s){super(e,...s),e instanceof t&&d.set(this,[y++,0,w()])}},v=new WeakSet,b=e=>(v.add(e),e),A=e=>null!==e&&"object"==typeof e&&!v.has(e),S=new WeakMap,m=(e,t,s)=>{if(d.has(e))t.set(e,d.get(e)[0]);else if(!(e instanceof u||e instanceof n))for(const r of p(e))A(r)&&!s.has(r)&&(s.add(r),m(r,t,s))},O=(...e)=>({value:new o((t=>{let s=new Worker("data:application/javascript,onmessage%3De%3D%3EpostMessage(!Atomics.wait(...e.data))");s.onmessage=()=>t("ok"),s.postMessage(e)}))}),k=(e,t)=>{const s=d.get(e),[r,n,{promise:a}]=s;return s[1]=t,[r,a]};let{BigInt64Array:E,Int32Array:T,SharedArrayBuffer:I,addEventListener:M,postMessage:J}=globalThis,N=!0,$=e=>e,j=!1;const x=w();try{new I(4),f.waitAsync||(f.waitAsync=O),x.resolve()}catch(t){const s=J,r=M,a=[],o=(e,t,s)=>s&&"number"==typeof t?BigInt(s.source):t;let i="",l="";I=class extends n{},E=h(E,I),T=h(T,I),$=b,j=!0,f.notify=(e,t)=>{const[r]=(e=>S.get(e))(e);return s([i,1,e,r,t]),0},f.waitAsync=(...e)=>{const[t,s]=k(...e);return{value:s}},f.wait=(t,s,...r)=>{const[n]=k(t,s,...r),a=new XMLHttpRequest;a.open("POST",`${l}?sabayon`,!1),a.setRequestHeader("Content-Type","application/json"),a.send(`["${i}",${n},${s}]`),d.delete(t);const c=t instanceof E?e(a.responseText,o):e(a.responseText);for(let e=0;e<c.length;e++)t[e]=c[e];return"ok"},r("message",(e=>{if(((e,t)=>{const{data:s}=e,r=c(s)&&(s.at(0)===t||0===s.at(1)&&!t);return r&&(e.stopImmediatePropagation(),e.preventDefault()),r})(e,i)){const[t,s,...r]=e.data;switch(s){case 0:i=t,l=r.at(0)?.serviceWorker||"",l||(f.wait=null,x.resolve());break;case 1:((e,t,s)=>{for(const[r,[n,a,{resolve:o}]]of d)if(t===n&&s===a){for(let t=0;t<e.length;t++)r[t]=e[t];d.delete(r),o("ok");break}})(...r);break;case 2:((e,t,s)=>{for(const[s,r]of t)S.set(s,[r,e.currentTarget]);g(e,s)})(e,...r);break;case 3:x.resolve()}}else if(N){const{currentTarget:t,type:s,origin:r,lastEventId:n,source:o,ports:c}=e;a.push([{currentTarget:t,type:s,origin:r,lastEventId:n,source:o,ports:c},e.data])}})),M=(e,...t)=>{if(r(e,...t),a.length)for(const e of a.splice(0))g(...e)},J=(e,...t)=>s(((e,t)=>{const s=new Map;return A(t)&&m(t,s,new Set),s.size?[e,2,s,t]:t})(i,e),...t)}await x.promise,N=!1;export{f as Atomics,E as BigInt64Array,T as Int32Array,I as SharedArrayBuffer,M as addEventListener,$ as ignore,j as polyfill,J as postMessage};
