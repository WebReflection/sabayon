const{isArray:e}=Array,{join:t}=[],s=new Map,o=e=>{e.stopImmediatePropagation(),e.preventDefault()},n=e=>e.waitUntil(clients.claim()),a=e=>{const{request:n}=e;"POST"===n.method&&n.url===`${location.href}?sabayon`&&(o(e),e.respondWith(n.json().then((async e=>{const{promise:o,resolve:a}=Promise.withResolvers(),r=e.join(",");s.set(r,a);for(const t of await clients.matchAll())t.postMessage(e);return o.then((e=>new Response(`[${t.call(e,",")}]`,n.headers)))}))))},r=t=>{const{data:n}=t;if(e(n)&&4===n.length){const[e,a,r,i]=n,l=[e,a,r].join(",");s.has(l)&&(o(t),s.get(l)(i),s.delete(l))}};export{n as activate,a as fetch,r as message};
