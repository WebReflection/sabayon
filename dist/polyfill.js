var e=Promise.withResolvers.bind(Promise);let{SharedArrayBuffer:t}=globalThis,s=!0;try{new t(4,{maxByteLength:8})}catch(e){s=!1,t=class extends ArrayBuffer{get growable(){return super.resizable}grow(e){super.resize(e)}}}const{isArray:o}=Array,{isView:r}=ArrayBuffer,{defineProperty:n,values:a}=Object;let i=()=>{};if(!s){globalThis.SharedArrayBuffer=t;const[s,l]=((t=e=>e)=>{const s=new Map;let o=0;return[()=>{let r;do{r=t(o++)}while(s.has(r));const n=e();return s.set(r,n),[r,n.promise]},(e,t,o)=>{const r=s.get(e);s.delete(e),o?r?.reject(o):r?.resolve(t)}]})(),c=new Map,f=(e,...t)=>{e.addEventListener(...t)};if("importScripts"in globalThis){const n=function(e,t){for(let s=0;s<t.length;s++){const o=g(e,t[s]);if(o)return o}},g=function(e,s){if(s&&"object"==typeof s&&!e.has(s)){if(e.add(s),!r(s))return n(e,o(s)?s:a(s));if(s instanceof Int32Array&&s.buffer instanceof t){const e=x++;return c.set(s,e),[T,e,s]}}},h=e=>function(t,...s){if(k){const o=g(new Set,t);e.call(this,o?[...o,t]:t,...s)}else u.then((()=>postMessage(t,...s)))};globalThis.postMessage=h(globalThis.postMessage);const{prototype:d}=globalThis.MessagePort;d.postMessage=h(d.postMessage);const[p,u]=s();f(self,"message",(e=>{e.stopImmediatePropagation(),l(p,e.data)}),{once:!0});let{wait:m,waitAsync:y}=Atomics;const{parse:b,stringify:w}=JSON,v=e=>({value:e,async:!0}),A=(e,t)=>{const s=new XMLHttpRequest;return s.open("POST",`${S}?sabayon`,t),s.send(w([T,c.get(e)])),s},M=(e,t)=>(e.set(b(t.responseText)),c.delete(e),"ok");Atomics.wait=(e,...t)=>c.has(e)?M(e,A(e,!1)):m(e,...t),Atomics.waitAsync=(t,...s)=>{if(c.has(t)){const{promise:s,resolve:o}=e(),r=A(t,!0);return r.onloadend=()=>o(M(t,r)),v(s)}return y?y(t,...s):v(import("./wait-async-SZ_kNXjF.js").then((({default:e})=>e(t,...s))))};let T,S,k=!1,x=Math.random();u.then((e=>{[T,S]=e,k=!0})),i=()=>u}else{const t=crypto.randomUUID(),r=new BroadcastChannel("dd78209b-186c-4f83-80e9-406becb7d9f3");r.onmessage=async e=>{const[s,o,n]=e.data;if(o===t)for(const[e,[t,o]]of c)if(t===n){await o.promise,c.delete(e);let t=e.length;for(;t--&&!e[t];);r.postMessage([s,e.slice(0,t+1)]);break}};const a=s=>{let{data:r}=s;if(o(r)&&r.at(0)===t){const[t,o,a,i]=r;c.set(a,[o,e()]),n(s,"data",{value:i})}};globalThis.MessageChannel=class extends globalThis.MessageChannel{constructor(){super(),f(this.port1,"message",a),f(this.port2,"message",a)}},globalThis.Worker=class extends globalThis.Worker{constructor(e,s){if(!h)throw new Error("ServiceWorker not registered");super(e,s).postMessage([t,h]),f(this,"message",a)}};const{notify:g}=Atomics;Atomics.notify=(e,...t)=>{const s=c.get(e);return s?(s[1].resolve(),0):g(e,...t)};let h="",d=null;const p=({serviceWorker:e},t)=>{let s,o=!0;e.getRegistration(h).then((t=>t??e.register(h))).then((function r(n){o=o&&!!e.controller,s=n.installing||n.waiting||n.active,"activated"===s.state?o?l(t):location.reload():f(s,"statechange",(()=>r(n)),{once:!0})}))};i=e=>{if(!d){h=new URL(e,location.href).href;const[t,o]=s();p(navigator,t),d=o}return d}}}var l=i;export{l as default};
